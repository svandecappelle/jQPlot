!function(a){function b(b,c,d){d=d||{},d.axesDefaults=d.axesDefaults||{},d.legend=d.legend||{},d.seriesDefaults=d.seriesDefaults||{};var e=!1;if(d.seriesDefaults.renderer==a.jqplot.FunnelRenderer)e=!0;else if(d.series)for(var f=0;f<d.series.length;f++)d.series[f].renderer==a.jqplot.FunnelRenderer&&(e=!0);e&&(d.axesDefaults.renderer=a.jqplot.FunnelAxisRenderer,d.legend.renderer=a.jqplot.FunnelLegendRenderer,d.legend.preDraw=!0,d.sortData=!1,d.seriesDefaults.pointLabels={show:!1})}function c(b,c,d){for(var e=0;e<this.series.length;e++)this.series[e].renderer.constructor==a.jqplot.FunnelRenderer&&this.series[e].highlightMouseOver&&(this.series[e].highlightMouseDown=!1)}function d(b){for(var c=0;c<this.series.length;c++)this.series[c].seriesColors=this.seriesColors,this.series[c].colorGenerator=a.jqplot.colorGenerator}function e(a,b,c){var d=a.series[b],e=a.plugins.funnelRenderer.highlightCanvas;e._ctx.clearRect(0,0,e._ctx.canvas.width,e._ctx.canvas.height),d._highlightedPoint=c,a.plugins.funnelRenderer.highlightedSeriesIndex=b,d.renderer.drawSection.call(d,e._ctx,d._vertices[c],d.highlightColors[c],!1)}function f(a){var b=a.plugins.funnelRenderer.highlightCanvas;b._ctx.clearRect(0,0,b._ctx.canvas.width,b._ctx.canvas.height);for(var c=0;c<a.series.length;c++)a.series[c]._highlightedPoint=null;a.plugins.funnelRenderer.highlightedSeriesIndex=null,a.target.trigger("jqplotDataUnhighlight")}function g(a,b,c,d,g){if(d){var h=[d.seriesIndex,d.pointIndex,d.data],i=jQuery.Event("jqplotDataMouseOver");if(i.pageX=a.pageX,i.pageY=a.pageY,g.target.trigger(i,h),g.series[h[0]].highlightMouseOver&&(h[0]!=g.plugins.funnelRenderer.highlightedSeriesIndex||h[1]!=g.series[h[0]]._highlightedPoint)){var j=jQuery.Event("jqplotDataHighlight");j.which=a.which,j.pageX=a.pageX,j.pageY=a.pageY,g.target.trigger(j,h),e(g,h[0],h[1])}}else null==d&&f(g)}function h(a,b,c,d,g){if(d){var h=[d.seriesIndex,d.pointIndex,d.data];if(g.series[h[0]].highlightMouseDown&&(h[0]!=g.plugins.funnelRenderer.highlightedSeriesIndex||h[1]!=g.series[h[0]]._highlightedPoint)){var i=jQuery.Event("jqplotDataHighlight");i.which=a.which,i.pageX=a.pageX,i.pageY=a.pageY,g.target.trigger(i,h),e(g,h[0],h[1])}}else null==d&&f(g)}function i(a,b,c,d,e){var g=e.plugins.funnelRenderer.highlightedSeriesIndex;null!=g&&e.series[g].highlightMouseDown&&f(e)}function j(a,b,c,d,e){if(d){var f=[d.seriesIndex,d.pointIndex,d.data],g=jQuery.Event("jqplotDataClick");g.which=a.which,g.pageX=a.pageX,g.pageY=a.pageY,e.target.trigger(g,f)}}function k(a,b,c,d,e){if(d){var g=[d.seriesIndex,d.pointIndex,d.data],h=e.plugins.funnelRenderer.highlightedSeriesIndex;null!=h&&e.series[h].highlightMouseDown&&f(e);var i=jQuery.Event("jqplotDataRightClick");i.which=a.which,i.pageX=a.pageX,i.pageY=a.pageY,e.target.trigger(i,g)}}function l(){this.plugins.funnelRenderer&&this.plugins.funnelRenderer.highlightCanvas&&(this.plugins.funnelRenderer.highlightCanvas.resetCanvas(),this.plugins.funnelRenderer.highlightCanvas=null),this.plugins.funnelRenderer={},this.plugins.funnelRenderer.highlightCanvas=new a.jqplot.GenericCanvas;var b=a(this.targetId+" .jqplot-data-label");b.length?a(b[0]).before(this.plugins.funnelRenderer.highlightCanvas.createElement(this._gridPadding,"jqplot-funnelRenderer-highlight-canvas",this._plotDimensions,this)):this.eventCanvas._elem.before(this.plugins.funnelRenderer.highlightCanvas.createElement(this._gridPadding,"jqplot-funnelRenderer-highlight-canvas",this._plotDimensions,this));this.plugins.funnelRenderer.highlightCanvas.setContext();this.eventCanvas._elem.bind("mouseleave",{plot:this},function(a){f(a.data.plot)})}a.jqplot.FunnelRenderer=function(){a.jqplot.LineRenderer.call(this)},a.jqplot.FunnelRenderer.prototype=new a.jqplot.LineRenderer,a.jqplot.FunnelRenderer.prototype.constructor=a.jqplot.FunnelRenderer,a.jqplot.FunnelRenderer.prototype.init=function(b,e){this.padding={top:20,right:20,bottom:20,left:20},this.sectionMargin=6,this.fill=!0,this.shadowOffset=2,this.shadowAlpha=.07,this.shadowDepth=5,this.highlightMouseOver=!0,this.highlightMouseDown=!1,this.highlightColors=[],this.widthRatio=.2,this.lineWidth=2,this.dataLabels="percent",this.showDataLabels=!1,this.dataLabelFormatString=null,this.dataLabelThreshold=3,this._type="funnel",this.tickRenderer=a.jqplot.FunnelTickRenderer,b.highlightMouseDown&&null==b.highlightMouseOver&&(b.highlightMouseOver=!1),a.extend(!0,this,b),this._highlightedPoint=null,this._bases=[],this._atot,this._areas=[],this._lengths=[],this._angle,this._dataIndices=[],this._unorderedData=a.extend(!0,[],this.data);for(var f=a.extend(!0,[],this.data),m=0;m<f.length;m++)f[m].push(m);this.data.sort(function(a,b){return b[1]-a[1]}),f.sort(function(a,b){return b[1]-a[1]});for(var m=0;m<f.length;m++)this._dataIndices.push(f[m][2]);if(0==this.highlightColors.length)for(var m=0;m<this.seriesColors.length;m++){for(var n=a.jqplot.getColorComponents(this.seriesColors[m]),o=[n[0],n[1],n[2]],p=o[0]+o[1]+o[2],q=0;3>q;q++)o[q]=p>570?.8*o[q]:o[q]+.4*(255-o[q]),o[q]=parseInt(o[q],10);this.highlightColors.push("rgb("+o[0]+","+o[1]+","+o[2]+")")}e.postParseOptionsHooks.addOnce(d),e.postInitHooks.addOnce(c),e.eventListenerHooks.addOnce("jqplotMouseMove",g),e.eventListenerHooks.addOnce("jqplotMouseDown",h),e.eventListenerHooks.addOnce("jqplotMouseUp",i),e.eventListenerHooks.addOnce("jqplotClick",j),e.eventListenerHooks.addOnce("jqplotRightClick",k),e.postDrawHooks.addOnce(l)},a.jqplot.FunnelRenderer.prototype.setGridData=function(a){for(var b=0,c=[],d=0;d<this.data.length;d++)b+=this.data[d][1],c.push([this.data[d][0],this.data[d][1]]);for(var d=0;d<c.length;d++)c[d][1]=c[d][1]/b;this._bases=new Array(c.length+1),this._lengths=new Array(c.length),this.gridData=c},a.jqplot.FunnelRenderer.prototype.makeGridData=function(a,b){for(var c=0,d=[],e=0;e<this.data.length;e++)c+=this.data[e][1],d.push([this.data[e][0],this.data[e][1]]);for(var e=0;e<d.length;e++)d[e][1]=d[e][1]/c;return this._bases=new Array(d.length+1),this._lengths=new Array(d.length),d},a.jqplot.FunnelRenderer.prototype.drawSection=function(a,b,c,d){function e(){a.beginPath(),a.fillStyle=c,a.strokeStyle=c,a.lineWidth=g,a.moveTo(b[0][0],b[0][1]);for(var d=1;4>d;d++)a.lineTo(b[d][0],b[d][1]);a.closePath(),f?a.fill():a.stroke()}var f=this.fill,g=this.lineWidth;if(a.save(),d)for(var h=0;h<this.shadowDepth;h++)a.save(),a.translate(this.shadowOffset*Math.cos(this.shadowAngle/180*Math.PI),this.shadowOffset*Math.sin(this.shadowAngle/180*Math.PI)),e();else e();if(d)for(var h=0;h<this.shadowDepth;h++)a.restore();a.restore()},a.jqplot.FunnelRenderer.prototype.draw=function(b,c,d,e){function f(a){var b=(A[1]-C[1])/(A[0]-C[0]),c=A[1]-b*A[0],d=a+A[1];return[(d-c)/b,d]}function g(a){var b=(B[1]-D[1])/(B[0]-D[0]),c=B[1]-b*B[0],d=a+B[1];return[(d-c)/b,d]}var h,i=void 0!=d?d:{},j=0,k=0,l=1;if(this._areas=[],d.legendInfo&&"insideGrid"==d.legendInfo.placement){var m=d.legendInfo;switch(m.location){case"nw":j=m.width+m.xoffset;break;case"w":j=m.width+m.xoffset;break;case"sw":j=m.width+m.xoffset;break;case"ne":j=m.width+m.xoffset,l=-1;break;case"e":j=m.width+m.xoffset,l=-1;break;case"se":j=m.width+m.xoffset,l=-1;break;case"n":k=m.height+m.yoffset;break;case"s":k=m.height+m.yoffset,l=-1}}var n=1==l?this.padding.left+j:this.padding.left,o=1==l?this.padding.top+k:this.padding.top,p=-1==l?this.padding.right+j:this.padding.right,q=-1==l?this.padding.bottom+k:this.padding.bottom,r=(void 0!=i.shadow?i.shadow:this.shadow,void 0!=i.showLine?i.showLine:this.showLine,void 0!=i.fill?i.fill:this.fill,b.canvas.width),s=b.canvas.height;this._bases[0]=r-n-p;var t=this._length=s-o-q,u=this._bases[0]*this.widthRatio;for(this._atot=t/2*(this._bases[0]+this._bases[0]*this.widthRatio),this._angle=Math.atan((this._bases[0]-u)/2/t),h=0;h<c.length;h++)this._areas.push(c[h][1]*this._atot);var v,w,x,y=0,z=1e-4;for(h=0;h<this._areas.length;h++){for(v=this._areas[h]/this._bases[h],w=999999,this._lengths[h]=v,x=0;w>this._lengths[h]*z&&100>x;)this._lengths[h]=this._areas[h]/(this._bases[h]-this._lengths[h]*Math.tan(this._angle)),w=Math.abs(this._lengths[h]-v),this._bases[h+1]=this._bases[h]-2*this._lengths[h]*Math.tan(this._angle),v=this._lengths[h],x++;y+=this._lengths[h]}this._vertices=new Array(c.length);var A=[n,o],B=[n+this._bases[0],o],C=[n+(this._bases[0]-this._bases[this._bases.length-1])/2,o+this._length],D=[C[0]+this._bases[this._bases.length-1],C[1]],E=j,F=k,G=0,H=0;for(h=0;h<c.length;h++){this._vertices[h]=new Array;var I=this._vertices[h],J=this.sectionMargin;0==h&&(H=0),1==h?H=J/3:h>0&&h<c.length-1?H=J/2:h==c.length-1&&(H=2*J/3),I.push(f(G+H)),I.push(g(G+H)),G+=this._lengths[h],0==h?H=-2*J/3:h>0&&h<c.length-1?H=-J/2:h==c.length-1&&(H=0),I.push(g(G+H)),I.push(f(G+H))}if(this.shadow)for(var K="rgba(0,0,0,"+this.shadowAlpha+")",h=0;h<c.length;h++)this.renderer.drawSection.call(this,b,this._vertices[h],K,!0);for(var h=0;h<c.length;h++){var I=this._vertices[h];if(this.renderer.drawSection.call(this,b,I,this.seriesColors[h]),this.showDataLabels&&100*c[h][1]>=this.dataLabelThreshold){var L,M;"label"==this.dataLabels?(L=this.dataLabelFormatString||"%s",M=a.jqplot.sprintf(L,c[h][0])):"value"==this.dataLabels?(L=this.dataLabelFormatString||"%d",M=a.jqplot.sprintf(L,this.data[h][1])):"percent"==this.dataLabels?(L=this.dataLabelFormatString||"%d%%",M=a.jqplot.sprintf(L,100*c[h][1])):this.dataLabels.constructor==Array&&(L=this.dataLabelFormatString||"%s",M=a.jqplot.sprintf(L,this.dataLabels[this._dataIndices[h]]));var E=(this._radius*this.dataLabelPositionFactor+this.sliceMargin+this.dataLabelNudge,(I[0][0]+I[1][0])/2+this.canvas._offsets.left),F=(I[1][1]+I[2][1])/2+this.canvas._offsets.top,N=a('<span class="jqplot-funnel-series jqplot-data-label" style="position:absolute;">'+M+"</span>").insertBefore(e.eventCanvas._elem);E-=N.width()/2,F-=N.height()/2,E=Math.round(E),F=Math.round(F),N.css({left:E,top:F})}}},a.jqplot.FunnelAxisRenderer=function(){a.jqplot.LinearAxisRenderer.call(this)},a.jqplot.FunnelAxisRenderer.prototype=new a.jqplot.LinearAxisRenderer,a.jqplot.FunnelAxisRenderer.prototype.constructor=a.jqplot.FunnelAxisRenderer,a.jqplot.FunnelAxisRenderer.prototype.init=function(b){this.tickRenderer=a.jqplot.FunnelTickRenderer,a.extend(!0,this,b),this._dataBounds={min:0,max:100},this.min=0,this.max=100,this.showTicks=!1,this.ticks=[],this.showMark=!1,this.show=!1},a.jqplot.FunnelLegendRenderer=function(){a.jqplot.TableLegendRenderer.call(this)},a.jqplot.FunnelLegendRenderer.prototype=new a.jqplot.TableLegendRenderer,a.jqplot.FunnelLegendRenderer.prototype.constructor=a.jqplot.FunnelLegendRenderer,a.jqplot.FunnelLegendRenderer.prototype.init=function(b){this.numberRows=null,this.numberColumns=null,a.extend(!0,this,b)},a.jqplot.FunnelLegendRenderer.prototype.draw=function(){if(this.show){var b=this._series,c="position:absolute;";c+=this.background?"background:"+this.background+";":"",c+=this.border?"border:"+this.border+";":"",c+=this.fontSize?"font-size:"+this.fontSize+";":"",c+=this.fontFamily?"font-family:"+this.fontFamily+";":"",c+=this.textColor?"color:"+this.textColor+";":"",c+=null!=this.marginTop?"margin-top:"+this.marginTop+";":"",c+=null!=this.marginBottom?"margin-bottom:"+this.marginBottom+";":"",c+=null!=this.marginLeft?"margin-left:"+this.marginLeft+";":"",c+=null!=this.marginRight?"margin-right:"+this.marginRight+";":"",this._elem=a('<table class="jqplot-table-legend" style="'+c+'"></table>');var d,e,f=!1,g=!1,h=b[0],i=new a.jqplot.ColorGenerator(h.seriesColors);if(h.show){var j=h.data;this.numberRows?(d=this.numberRows,e=this.numberColumns?this.numberColumns:Math.ceil(j.length/d)):this.numberColumns?(e=this.numberColumns,d=Math.ceil(j.length/this.numberColumns)):(d=j.length,e=1);var k,l,m,n,o,p,q,r,s=0;for(k=0;d>k;k++)for(m=g?a('<tr class="jqplot-table-legend"></tr>').prependTo(this._elem):a('<tr class="jqplot-table-legend"></tr>').appendTo(this._elem),l=0;e>l;l++)s<j.length&&(p=this.labels[s]||j[s][0].toString(),r=i.next(),f=g?k==d-1?!1:!0:k>0?!0:!1,q=f?this.rowSpacing:"0",n=a('<td class="jqplot-table-legend" style="text-align:center;padding-top:'+q+';"><div><div class="jqplot-table-legend-swatch" style="border-color:'+r+';"></div></div></td>'),o=a('<td class="jqplot-table-legend" style="padding-top:'+q+';"></td>'),this.escapeHtml?o.text(p):o.html(p),g?(o.prependTo(m),n.prependTo(m)):(n.appendTo(m),o.appendTo(m)),f=!0),s++}}return this._elem},a.jqplot.preInitHooks.push(b),a.jqplot.FunnelTickRenderer=function(){a.jqplot.AxisTickRenderer.call(this)},a.jqplot.FunnelTickRenderer.prototype=new a.jqplot.AxisTickRenderer,a.jqplot.FunnelTickRenderer.prototype.constructor=a.jqplot.FunnelTickRenderer}(jQuery);